const Common  = new MainHelpers(),
      Helpers = new LeaveConfigTablesHelpers(),
      API     = new LeaveConfigTablesAPI()
         


// When DOM is loaded
window.addEventListener('DOMContentLoaded', () => {
     // fetch all leave config tables & update DOM
     API.getLeaveCT().then(resp => { 
        // populate list of config table to view data
        Helpers.populateViewData(resp.data)
        // populate config table data (when selected from view data list) 
        const myCT = document.querySelectorAll('.myConfigT')
        myCT.forEach(element => {
            element.addEventListener('click', (e) => {
                const wanted = e.target.innerHTML
                // populate config table rows
                Helpers.populateCT(resp.data[wanted], wanted)
                // when one entry is clicked (edit name)
                document.querySelectorAll('.showValue').forEach(element => {             
                    element.addEventListener('click', (e) => {
                        const rowID = e.target.dataset.id
                        Helpers.editableRow(rowID)
                    })
                })
                // when save entry is clicked (save button)
                document.querySelectorAll('.saveValue').forEach(element => {             
                    element.addEventListener('click', (e) => {
                        const rowID = e.target.dataset.id,
                              ctName = document.querySelector('#configTableTitle').innerHTML,
                              ctValue = document.querySelector('#editValue'+rowID).value
        
                        API.updateConfigTableEntry(ctName,ctValue,rowID,connectedEmail).then(resp => {
                            if (!resp.error) location.reload()
                        })
                    })
                })
            })
        })        
    }) 

    // when add button is clicked (clear form)
    document.querySelector('#openModal').addEventListener('click', () => {
        Common.insertInputValue('', 'ctNewValue')
    })
  
    // when add new entry is clicked (submit)
    document.querySelector('#ctSubmit').addEventListener('click', () => {
        if (document.querySelector('#ctNewValue').value != '') {
            const myCT = document.querySelector('#ctName').value,
                  myValue = document.querySelector('#ctNewValue').value
            API.addNewConfigTableEntry(myCT, myValue, connectedEmail).then(resp => {
                if (!resp.error) location.reload()
            })
        }
    })

   // when delete entry is clicked (checkboxes)
   document.querySelector('#deleteCT').addEventListener('click', () => {
    const entryChecked = Helpers.selectedEntry(),
          ctName = document.querySelector('#configTableTitle').innerHTML
    API.deleteConfigTableEntry(entryChecked, ctName, connectedEmail).then(resp => {
        if (!resp.error) location.reload()
    })
   })

})
